# ============================================================
# üîç AIHomeCoder ‚Äì Audit Pr√©ventif de Structure
# ============================================================
# Fichier : missions/audit_readonly_aihomecoder.yalm
# Auteur  : Pr√©-Humain Directeur Adjoint
# Date    : 2025-10-30
# Version : 1.0
# But     : V√©rifier la coh√©rence structurelle et la propret√©
#           du projet AIHomeCoder avant int√©gration Claude Code.
# ============================================================

mission:
  name: "audit_readonly_aihomecoder"
  description: >
    Audit rapide et non destructif du code AIHomeCoder.
    V√©rifie la conformit√© Clean Architecture, les d√©pendances
    internes, les modules sensibles (guardrail, settings, file_manager)
    et la clart√© des profils de configuration.
  author: "Pr√©-Humain Directeur Adjoint"
  model: "qwen_local"
  mode: "read_only"

scope:
  include:
    - ./core/**/*.py
    - ./config/**/*.yaml
    - ./missions/**/*.yalm
    - ./run_mission.py
    - ./main.py
  exclude:
    - ./data/**
    - ./logs/**
    - ./reports/**
    - ./exchange/**
  max_files: 300
  max_file_size: 1MB

# ============================================================
# üß© √âtapes d'audit
# ============================================================

steps:
  - name: "scan_structure"
    description: "Lister les r√©pertoires et modules principaux."
    action: "analyze_directory_tree"

  - name: "check_imports"
    description: "D√©tecter les imports circulaires ou hors couche."
    action: "scan_import_dependencies"
    targets:
      - ./core/
      - ./domain/
      - ./presentation/

  - name: "analyze_guardrails"
    description: "V√©rifier la coh√©rence du fichier guardrail.py avec les modes de profil."
    action: "parse_python"
    target: ./core/guardrail.py
    expect_keywords: ["enforce_task_restrictions", "read_only", "write"]

  - name: "validate_profiles"
    description: "V√©rifier que les profils (default, qwen_local, deepseek_local) sont coh√©rents."
    action: "analyze_yaml"
    targets:
      - ./config/profiles/*.yaml

  - name: "detect_yalm_missions"
    description: "Lister et valider la syntaxe des fichiers .yalm."
    action: "parse_yaml_files"
    targets:
      - ./missions/

  - name: "generate_report"
    description: "Synth√©tiser l‚Äôanalyse dans un rapport Markdown clair."
    action: "write_file"
    target: "./reports/audit_aihomecoder_structure_{date}.md"
    content: |
      # üß© Audit Structurel ‚Äì AIHomeCoder

      **Date :** {date}  
      **Mode :** Read-Only  
      **Analyste :** Qwen Local  

      ## R√©sum√©
      - R√©pertoires audit√©s : core/, config/, missions/
      - V√©rifications : imports, profils, guardrails, structure .yalm
      - Statut g√©n√©ral : ‚úÖ Stable / ‚ö†Ô∏è Anomalies mineures / üî¥ Violations critiques

      ## Points de vigilance
      - Imports circulaires : {imports_detected}
      - Profils incoh√©rents : {profiles_issues}
      - Guardrail incoh√©rence : {guardrail_status}
      - Missions invalides : {invalid_yalm_count}

      ## Recommandations
      1. Corriger les √©ventuels imports crois√©s entre core/domain.
      2. V√©rifier la coh√©rence entre mode par d√©faut et guardrail.
      3. Simplifier les missions en double (si d√©tect√©es).
      4. Rejouer un audit complet apr√®s int√©gration Claude Legacy.

      ## Prochaine √©tape
      Lancer ensuite :
      ```bash
      python run_mission.py missions/install_claude_legacy.yalm
      ```
      pour greffer la m√©moire Claude Code.

# ============================================================
# ‚úÖ FIN DE MISSION
# ============================================================
