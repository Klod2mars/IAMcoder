# ===========================================================
# üß† A I H O M E C O D E R üß†
# Version: 1.0.0
# Auteur : Claude AI
# Date : 2025-10-30
# ===========================================================
# Objectif :
# Cr√©er une application Python modulaire suivant Clean Architecture
# servant d‚Äôex√©cuteur local de code et d‚Äôinterpr√®te de fichiers .YALM
# pour ex√©cuter des audits, refactors et diff locaux.
# ===========================================================

meta:
  project_name: "aihomecoder"
  architecture: "Clean Architecture (domain / data / presentation)"
  language: "Python 3.10+"
  description: >
    aihomecoder est un moteur local de co-√©dition de code inspir√© de Cursor,
    utilisant un mod√®le IA local (Qwen ou DeepSeek) pour interpr√©ter et appliquer
    des missions .YALM, avec syst√®me de diff, rollback et logs Markdown.
  author: "Claude AI"
  version: "1.0.0"

stack:
  frameworks:
    - typer          # CLI ergonomique
    - pyyaml         # Lecture .yalm
    - gitpython      # Sauvegarde & rollback
    - difflib        # G√©n√©ration des diffs
    - chromadb       # Index vectoriel
    - loguru         # Journaux
    - rich           # Couleur & formatage terminal
  optional:
    - textual        # Interface TUI future
    - fastapi        # Extension API √©ventuelle
  ia_model:
    engine: "ollama"
    model_default: "qwen2-coder:7b-instruct"
    alt_model: "deepseek-coder:6.7b"
  environment:
    min_python: "3.10"
    os_compatible:
      - linux
      - macos
      - windows

security:
  sanctuaire_protection:
    ignore_paths:
      - "data/hive_boxes/**"
      - ".env"
      - "private/**"
      - ".git/**"
  rollback: true

# ===========================================================
# üì¶ STRUCTURE DU PROJET
# ===========================================================
structure:
  - domain/
  - data/
  - presentation/
  - core/
  - config/
  - logs/
  - modules/
  - tests/
  - README.md
  - .aihomecoderignore
  - requirements.txt

# ===========================================================
# üß© DOMAIN LAYER
# ===========================================================
domain:
  description: >
    Contient la logique pure et les entit√©s fondamentales :
    - Task (une t√¢che issue du YAML)
    - Mission (ensemble coh√©rent de tasks)
    - DiffResult (r√©sultat d‚Äôune comparaison de fichiers)
  files:
    - domain/entities/task.py
    - domain/entities/mission.py
    - domain/entities/diff_result.py
    - domain/services/executor_service.py

# ===========================================================
# üóÉÔ∏è DATA LAYER
# ===========================================================
data:
  description: >
    Contient les modules de gestion de donn√©es, contexte et IA :
    - yaml_parser : lecture & validation des fichiers .yalm
    - diff_engine : cr√©ation et application de patchs
    - context_index : index vectoriel via ChromaDB
    - ai_connector : interface avec Ollama
  files:
    - data/yaml_parser.py
    - data/diff_engine.py
    - data/context_index.py
    - data/ai_connector.py

# ===========================================================
# üí¨ PRESENTATION LAYER
# ===========================================================
presentation:
  description: >
    Interface CLI et affichage utilisateur :
    - CLI principale
    - gestion des logs & couleurs
    - aper√ßu des diffs avant √©criture
  files:
    - presentation/cli.py
    - presentation/logger.py
    - presentation/ui_diff_view.py

# ===========================================================
# üîß CORE & CONFIG
# ===========================================================
core:
  description: >
    Contient les utilitaires transverses :
    - guardrail.py : protection des chemins sanctuaires
    - file_manager.py : lecture/√©criture s√©curis√©e
    - settings.py : param√®tres globaux
  files:
    - core/guardrail.py
    - core/file_manager.py
    - core/settings.py

config:
  description: >
    Contient la configuration de base et profils IA :
  files:
    - config/settings.yaml
    - config/profiles/default.yaml
    - config/profiles/qwen_local.yaml
    - config/profiles/deepseek_local.yaml

# ===========================================================
# üöÄ T√ÇCHES DE CONSTRUCTION
# ===========================================================
tasks:
  - name: "Cr√©er structure Clean Architecture"
    goal: "G√©n√©rer toutes les couches domain, data, presentation, core"
  - name: "Impl√©menter yaml_parser"
    goal: "Lecture, validation et d√©coupage des fichiers .yalm"
  - name: "Impl√©menter diff_engine"
    goal: "Cr√©ation de patchs et rollback GitPython"
  - name: "Impl√©menter context_index"
    goal: "Indexation du code en embeddings ChromaDB"
  - name: "Impl√©menter ai_connector"
    goal: "Connexion locale √† Ollama avec Qwen ou DeepSeek"
  - name: "Impl√©menter CLI principale"
    goal: "Commandes : run, audit, diff, log"
  - name: "Int√©grer guardrail & s√©curit√© sanctuaire"
    goal: "Emp√™cher la modification des zones critiques"
  - name: "Cr√©er fichiers de config par d√©faut"
    goal: "Param√©trer le mod√®le IA, les chemins et les logs"
  - name: "R√©diger README.md"
    goal: "Documenter l‚Äôusage et la structure"

# ===========================================================
# üìÑ FICHIERS √Ä LIVRER
# ===========================================================
final_deliverable:
  - "Projet Python complet respectant Clean Architecture"
  - "CLI fonctionnelle : aihomecoder run <mission.yalm>"
  - "README.md d√©taill√©"
  - "config/settings.yaml"
  - "example_mission.yalm"
  - "journal d‚Äôaudit automatique (logs/session_*.md)"
