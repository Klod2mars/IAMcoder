# ===========================================================
# üß† A I H O M E C O D E R ‚Äì PHASE DE TEST INTERNE V1.0 üß†
# ===========================================================
meta:
  project: "aihomecoder"
  mission: "Validation du moteur de base"
  author: "Claude AI"
  date: "2025-10-30"
  mode: "execution-local"
  target_folder: "./"
  notes: >
    Ce plan teste les modules fondamentaux du moteur aihomecoder :
    - Lecture et parsing des fichiers .YALM
    - G√©n√©ration et application de diffs
    - Connexion IA locale (simulation)
    - Rollback, logs et sanctuaire
    Les tests sont ex√©cut√©s sans d√©pendre d‚Äôun mod√®le externe actif.
# ===========================================================

stack_check:
  python_version: ">=3.10"
  required_libs:
    - typer
    - pyyaml
    - gitpython
    - chromadb
    - rich
    - loguru
  optional_libs:
    - textual
    - fastapi
  expected_entrypoint: "main.py"

security:
  rollback_enabled: true
  ignore_paths:
    - "data/hive_boxes/**"
    - ".env"
    - ".git/**"

# ===========================================================
# üß™ TESTS UNITAIRES & INT√âGR√âS
# ===========================================================
tests:
  - name: "V√©rifier le parsing des fichiers .YALM"
    description: >
      Charger example_mission.yalm et s‚Äôassurer que le parser
      extrait correctement le nom des t√¢ches et leurs fichiers cibles.
    file_target: "data/yaml_parser.py"
    expected_output: "Liste de tasks d√©tect√©e"

  - name: "Tester la cr√©ation d‚Äôun diff"
    description: >
      Modifier une fonction de test dans tests/dummy_file.py,
      g√©n√©rer un patch avec diff_engine.py et v√©rifier que le rollback
      restaure l‚Äô√©tat initial.
    files:
      - "data/diff_engine.py"
      - "tests/dummy_file.py"
    expected_output: "Patch g√©n√©r√© + rollback confirm√©"

  - name: "Simuler une ex√©cution IA"
    description: >
      Simuler un prompt envoy√© au connecteur IA local (ai_connector.py)
      avec un texte simple et v√©rifier que le moteur renvoie une r√©ponse.
    files:
      - "data/ai_connector.py"
    expected_output: "R√©ponse simul√©e : OK"

  - name: "V√©rifier le logger"
    description: >
      G√©n√©rer un log Markdown dans /logs/session_test.md contenant
      les 3 √©tapes pr√©c√©dentes.
    files:
      - "presentation/logger.py"
      - "logs/session_test.md"
    expected_output: "Fichier log cr√©√© avec horodatage"

  - name: "Valider la CLI principale"
    description: >
      Lancer la commande `python main.py run example_mission.yalm`
      et v√©rifier que toutes les √©tapes s‚Äôex√©cutent sans erreur.
    files:
      - "presentation/cli.py"
      - "main.py"
    expected_output: "Ex√©cution termin√©e sans erreur"

# ===========================================================
# üìä RAPPORT FINAL
# ===========================================================
report:
  output_file: "logs/session_validation_phase1.md"
  include_sections:
    - "R√©sultats des tests"
    - "Logs d√©taill√©s"
    - "Statut de rollback"
    - "R√©sum√© final"
  success_condition: "5/5 tests passed"

# ===========================================================
# ‚úÖ ATTENDU FINAL
# ===========================================================
final_deliverable:
  - "Un rapport Markdown complet dans /logs/session_validation_phase1.md"
  - "Confirmation que la CLI fonctionne"
  - "Parser YAML op√©rationnel"
  - "DiffEngine et rollback valid√©s"
  - "Logs lisibles en console (Rich + Loguru)"
