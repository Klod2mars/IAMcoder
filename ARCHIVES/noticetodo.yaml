# ============================================================
# üß≠ Mission Test ‚Äì Lecture seule du workspace s√©lectionn√© (v2)
# Objectif : Explorer la structure r√©elle du workspace et produire
#             un rapport Markdown complet avec un mini "tree".
# ============================================================

meta:
  project_name: "test_readonly_tree_scan_v2"
  version: "2.0.0"
  description: "Lecture du workspace externe (3 niveaux), g√©n√©ration d‚Äôun arbre et statistiques des extensions."
  author: "Pr√©-Humain Directeur Adjoint"
  model: "qwen2.5-coder:7b"
  memory: "config/profiles/qwen_local.yaml"

context:
  environment: "ollama"
  mode: "read_only_audit"
  language: "fr"
  output_format: "markdown"
  philosophy: "Observer sans modifier, comprendre avant d‚Äôagir."
  sanctuaire_hive: true

tasks:
  - name: "S√©lection du dossier de travail"
    goal: "Inviter l‚Äôutilisateur √† choisir le dossier du projet √† lire (ex : PermaCalendar V2)."
    task_type: "setup"
    parameters:
      ask_user_path: true
      variable_path: "external_workspace"
      read_only_mode: true
      log_all_actions: true

  - name: "Exploration du workspace"
    goal: "Parcourir la structure du workspace (3 niveaux) et recueillir les statistiques."
    task_type: "analysis"
    parameters:
      workspace_path: "${external_workspace}"
      depth: 3
      include_ext:
        - ".dart"
        - ".py"
        - ".json"
        - ".yaml"
        - ".md"
      exclude_patterns:
        - ".git/**"
        - "build/**"
        - "dist/**"
        - "node_modules/**"
        - "venv/**"
      output_data: "data/tree_${external_workspace}.json"

  - name: "G√©n√©ration du rapport Markdown"
    goal: "Cr√©er un fichier Markdown avec : r√©sum√©, arbre, extensions, compte des fichiers."
    task_type: "report_generation"
    parameters:
      format: "markdown"
      destination: "reports/tree_readonly_${external_workspace}.md"
      sections:
        - "R√©sum√©"
        - "Arborescence (3 niveaux)"
        - "Extensions d√©tect√©es"
        - "Horodatage et dossier source"
      render_logic: |
        # üå≥ Rapport de Lecture ‚Äî ${external_workspace}
        **Date** : {{ now }}
        **Mode** : Lecture seule  
        **Workspace** : ${external_workspace}

        ---

        ## R√©sum√©
        Lecture effectu√©e sur 3 niveaux de profondeur.  
        Fichiers analys√©s : {{ file_count }}  
        Dossiers parcourus : {{ folder_count }}

        ---

        ## Arborescence (3 niveaux)
        {{ tree_structure }}

        ---

        ## Extensions d√©tect√©es
        {% for ext, count in extensions.items() %}
        - **{{ ext }}** : {{ count }} fichier(s)
        {% endfor %}

        ---

        _Rapport g√©n√©r√© automatiquement par AIHomeCoder v1.0.0 ‚Äî Mode lecture seule_

outputs:
  - format: "markdown"
    destination: "reports/tree_readonly_${external_workspace}.md"
  - format: "json"
    destination: "data/tree_${external_workspace}.json"

post_actions:
  - "Validate that all output files exist."
  - "Display the first 25 lines of the Markdown report in console."
  - "Print confirmation message: '‚úÖ Lecture compl√®te termin√©e ‚Äî rapport d‚Äôarborescence g√©n√©r√© avec succ√®s.'"

intent:
  - "Observer la structure r√©elle du workspace externe."
  - "Lister les r√©pertoires et fichiers sur 3 niveaux."
  - "Cr√©er un rapport Markdown lisible et informatif."
